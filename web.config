<?xml version="1.0" encoding="UTF-8"?>
<configuration>
  <system.webServer>
    <!-- Configuración de FastCGI -->
    <fastCgi>
      <application fullPath="C:\Python39\python.exe"
                   arguments='-u "C:\WebApps\voleystats\voley\app.py"'
                   maxInstances="4"
                   idleTimeout="300"
                   activityTimeout="30"
                   requestTimeout="90"
                   instanceMaxRequests="10000">
        <environmentVariables>
          <environmentVariable name="PYTHONPATH" value="C:\WebApps\voleystats\voley\" />
          <environmentVariable name="WSGI_HANDLER" value="app.app" />
        </environmentVariables>
      </application>
    </fastCgi>

    <!-- Configuración de manejadores -->
    <handlers>
      <add name="FlaskFastCGI"
           path="*"
           verb="*"
           modules="FastCgiModule"
           scriptProcessor="C:\Python39\python.exe|-u &quot;C:\WebApps\voleystats\voley\app.py&quot;"
           resourceType="Unspecified"
           allowPathInfo="true" />
    </handlers>

    <!-- Reglas de reescritura -->
    <rewrite>
      <rules>
        <!-- Regla para redirigir HTTP a HTTPS -->
        <rule name="HTTP to HTTPS redirect" stopProcessing="true">
          <match url="(.*)" />
          <conditions>
            <add input="{HTTPS}" pattern="off" />
          </conditions>
          <action type="Redirect" url="https://{HTTP_HOST}/{R:1}" redirectType="Permanent" />
        </rule>

        <!-- Regla para reescribir todas las solicitudes a app.py -->
        <rule name="RewriteToFlask" stopProcessing="true">
          <match url="^(.*)$" />
          <action type="Rewrite" url="app.py/{R:1}" appendQueryString="true" />
        </rule>
      </rules>
    </rewrite>

    <!-- Documento predeterminado (opcional) -->
    <defaultDocument>
      <files>
        <add value="app.py" />
      </files>
    </defaultDocument>
  </system.webServer>
</configuration>